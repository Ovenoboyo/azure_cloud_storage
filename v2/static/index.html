<!DOCTYPE html>
<html>

<head>
    <title>Example</title>
</head>

<body>
    <div>
        <input type="text" name="username" id="username" />
        <input type="password" name="password" id="password" />
        <input type="file" id="fileUpload" name="myfile">
        <button type="submit" id="login">Login</button>
        <button type="submit" id="register">Register</button>
        <button type="submit" id="upload">Upload</button>
        <button type="submit" id="list">List</button>
    </div>
    <div>
        <span id="status"></span>
    </div>
</body>

</html>

<script>
    let uid
    let token

    document.getElementById("login").onclick = () => {
        sendReq('/login')
    }

    document.getElementById("register").onclick = () => {
        sendReq('/register')
    }

    document.getElementById("upload").onclick = () => {
        uploadFile()
    }

    document.getElementById("list").onclick = () => {
        listFiles()
    }

    listFiles = () => {
        if (token) {
            fetch('/api/list', {
                headers: new Headers({
                    'Authorization': 'Bearer ' + token,
                }),
            }).then(resp => resp.json()).then(data => {
                console.log(data)
            })
        }
    }

    uploadFile = () => {
        const file = document.getElementById("fileUpload")
        console.log(file.files[0])
        if (token) {
            fetch('/api/upload?path=' + file.files[0].name, {
                method: 'POST',
                headers: new Headers({
                    'Authorization': 'Bearer ' + token,
                }),
                body: file.files[0]
            }).then(r => {
                console.log(r)
            }).catch(e => {
                console.log(e)
            })
        }
    }

    sendReq = (url) => {
        const username = document.getElementById("username").value
        const password = document.getElementById("password").value

        fetch(url, {
            method: "POST",
            body: JSON.stringify({ username: username, password: password })
        }).then(resp => resp.json()).then(json => {
            if (json.success !== undefined) {
                document.getElementById('status').innerText = json.success ? 'Success' : 'Failed'
                if (url === '/login' && json.success) {
                    token = json.data.token
                }
            }

            if (json.error !== undefined) {
                document.getElementById('status').innerText = json.error
            }
        })
    }
</script>